# Headless service for StatefulSet (stable network identity)
apiVersion: v1
kind: Service
metadata:
  name: {{ include "opennebula.fullname" . }}-headless
  labels:
    {{- include "opennebula.labels" . | nindent 4 }}
spec:
  type: ClusterIP
  clusterIP: None
  selector:
    {{- include "opennebula.selectorLabels" . | nindent 4 }}
  ports:
    - port: 2633
      targetPort: 2633
      name: oned
    - port: 4124
      targetPort: 4124
      protocol: TCP
      name: monitord-tcp
    - port: 4124
      targetPort: 4124
      protocol: UDP
      name: monitord-udp
    - port: 22
      targetPort: 22
      protocol: TCP
      name: ssh
---
# External access service
apiVersion: v1
kind: Service
metadata:
  name: {{ include "opennebula.fullname" . }}
  labels:
    {{- include "opennebula.labels" . | nindent 4 }}
spec:
  type: {{ .Values.service.type }}
  selector:
    {{- include "opennebula.selectorLabels" . | nindent 4 }}
  ports:
    - port: 2633
      targetPort: 2633
      name: oned
    - port: 2616
      targetPort: {{ if .Values.fireedgeProxy.enabled }}8080{{ else }}2616{{ end }}
      name: fireedge
    - port: 2474
      targetPort: 2474
      name: oneflow
    - port: 5030
      targetPort: 5030
      name: onegate
    # Monitoring port (TCP) - hypervisor probes
    - port: 4124
      targetPort: 4124
      protocol: TCP
      name: monitord-tcp
    # Monitoring port (UDP) - hypervisor probe messages
    - port: 4124
      targetPort: 4124
      protocol: UDP
      name: monitord-udp
    # SSH for transfer manager operations
    - port: 22
      targetPort: 22
      protocol: TCP
      name: ssh
